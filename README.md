# Data_Analysis_CUPED
Проблема: Высокая дисперсия мешает обнаруживать эффекты

Пример:

    У нас тест новой рекомендательной системы

    Primary метрика: Средний чек (Revenue Per User)

    Пользователи разные: кто-то тратит $5, кто-то $500

    Высокая дисперсия → нужны огромные выборки для обнаружения даже разумных эффектов

    Тест требует 500к пользователей и 2 месяца...

Решение: Используем информацию, которая у нас УЖЕ есть

У каждого пользователя есть историческое поведение ДО теста:

    Сколько он тратил раньше

    Как часто заходил

    Какие категории покупал

Если пользователь и раньше много тратил, он и в тесте, скорее всего, будет тратить много. 
CUPED использует эту корреляцию, чтобы уменьшить шум.

CUPED (Controlled-experiment Using Pre-Experiment Data)


Вместо того чтобы сравнивать сырые метрики:
text

Y_raw = Средний чек в тесте

Мы сравниваем скорректированные метрики:
text

Y_adj = Y_raw - θ * X

где:

    X — предэкспериментальная метрика (например, траты за месяц до теста)

    θ — коэффициент регрессии (насколько X предсказывает Y)

Математическая формула

Для каждого пользователя i:
text

Y_cuped_i = Y_i - θ * (X_i - mean(X))

где:

    Y_i — метрика в тесте

    X_i — предэкспериментальная метрика

    mean(X) — среднее по всем пользователям

    θ = cov(X, Y) / var(X) — коэффициент из линейной регрессии

Результат: var(Y_cuped) < var(Y) на величину (1 - ρ²), где ρ — корреляция между X и Y.
